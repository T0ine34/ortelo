<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: server_modules/events/main.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ClientSocket.CSocket.html">CSocket</a></div><div class="sidebar-section-children"><a href="Events.EVENT.html">EVENT</a></div><div class="sidebar-section-children"><a href="Events.EVENTS_NAMESPACE.html">EVENTS_NAMESPACE</a></div><div class="sidebar-section-children"><a href="Game.html">Game</a></div><div class="sidebar-section-children"><a href="GameLoader.html">GameLoader</a></div><div class="sidebar-section-children"><a href="Server.User.html">User</a></div><div class="sidebar-section-children"><a href="ServerSocket.CIO.html">CIO</a></div><div class="sidebar-section-children"><a href="ServerSocket.CSocket.html">CSocket</a></div><div class="sidebar-section-children"><a href="ServerSocket.Room.html">Room</a></div><div class="sidebar-section-children"><a href="Settings.html">Settings</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ClientSocket.html">ClientSocket</a></div><div class="sidebar-section-children"><a href="Events.html">Events</a></div><div class="sidebar-section-children"><a href="Server.html">Server</a></div><div class="sidebar-section-children"><a href="Server.JsonChecker.html">JsonChecker</a></div><div class="sidebar-section-children"><a href="Server.ServerSocket.html">ServerSocket</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">server_modules_events_main.js</h1></header><article><pre class="prettyprint source lang-js"><code>/**
 * @file This file contains the events module.
 * @description This file is only used on the server side; another file is used on the client side.
 */

/**
 * @namespace ServerSocket
 * @memberof Server
 * @description This namespace contains the classes used to create a custom socket.io server implementing rooms and events.
 */

const { EVENTS, EVENT } = require("../../public/modules/events/events.js");
const { Server }        = require("socket.io");


/**
 * @description This class is used to create a room.
 * @memberof ServerSocket
 */
class Room{
    /**
     * @description Create a new room.
     * @param {string} name The name of the room.
     */
    constructor(name){
        this._name = name;
        this._users = new Set();
        this._user_list = new Set();
        this._use_as_whitelist = false; //if true, the _user_list will be used as a whitelist instead of a blacklist
        this._is_visible = true;        //if false, the room will not be visible by users that cannot join it
                                        //if true, the room will be visible by all users
    }

    /**
     * @description Set the visibility of the room.
     * @param {boolean} bool - true if the room should be visible, false otherwise.
     */
    set visible(bool){
        if(typeof bool !== "boolean") throw new Error("bool is not a boolean");
        this._is_visible = bool;
    }

    /**
     * @description Return true if the room is visible, false otherwise.
     * @returns {boolean} true if the room is visible, false otherwise.
     */
    get visible(){
        return this._is_visible;
    }

    /**
     * @description Add a user to the room.
     * @param {CSocket} user - The user to add.
     * @returns {boolean} true if the user has been added, false otherwise.
     * @throws {Error} if the user is not a CSocket object.
     * @returns {boolean} true if the user has been added, false otherwise.
     */
    addUser(user){
        //add the user to the room if he is not in blacklist or if he is in whitelist
        //return true if the user has been added, false otherwise
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        if(this.can_join(user)){
            this._users.add(user);
            return true;
        }
        else{
            return false;
        }
    } 

    /**
     * @see Room#addUser
     */
    join(user){
        return this.addUser(user);
    }

    /**
     * @description Remove a user from the room.
     * @param {CSocket} user - The user to remove.
     * @throws {Error} if the user is not a CSocket object.
     * @throws {Error} if the user is not in the room.
     * @returns {boolean} true if the user has been removed, false otherwise.
     */
    removeUser(user){
        //remove the user from the room
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        if(!this._users.has(user)) throw new Error("user is not in the room");
        this._users.delete(user);
    }

    /**
     * @description Return the name of the room.
     * @returns {string} The name of the room.
     * @readonly
     */
    get name(){
        return this._name;
    }

    /**
     * @description Return the users in the room.
     * @returns {Set&lt;CSocket>} The users in the room.
     * @readonly
     */
    get users(){
        return this._users;
    }

    /**
     * @description force a user to leave the room.
     * @param {CSocket} user - The user to kick.
     * @throws {Error} if the user is not a CSocket object.
     * @throws {Error} if the user is not in the room.
     * @returns {boolean} true if the user has been removed, false otherwise.
     */
    kick(user){
        //force a user to leave the room
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        this._users.delete(user);
    }

    /**
     * @description Set the room to use a whitelist or a blacklist.
     * @param {boolean} bool - true if the room should use a whitelist, false otherwise.
     * @throws {Error} if bool is not a boolean.
     * @description if the list mode is changed, the list will be cleared.
     */
    set use_whitelist(bool){
        if(typeof bool !== "boolean") throw new Error("bool is not a boolean");
        if(this._use_as_whitelist === bool) return;
        this._user_list.clear();
        this._use_as_whitelist = bool;
    }

    /**
     * @description Return true if the room is using a whitelist, false otherwise.
     * @returns {boolean} true if the room is using a whitelist, false otherwise.
     * @readonly
     */
    get use_whitelist(){
        return this._use_as_whitelist;
    }

    /**
     * @description Add a user to the whitelist.
     * @param {CSocket} user - The user to add.
     * @throws {Error} if the room is not using a whitelist.
     * @throws {Error} if the user is not a CSocket object.
     * @description if the user is already in the whitelist, nothing will happen.
     */
    add_to_whitelist(user){
        if(!this._use_as_whitelist) throw new Error("this room is not using a whitelist");
        this.add_to_list(user);
    }

    /**
     * @description Add a user to the blacklist.
     * @param {CSocket} user - The user to add.
     * @throws {Error} if the room is not using a blacklist.
     * @throws {Error} if the user is not a CSocket object.
     * @description if the user is already in the blacklist, nothing will happen.
     */
    add_to_blacklist(user){
        if(this._use_as_whitelist) throw new Error("this room is not using a blacklist");
        this.add_to_list(user);
    }

    /**
     * @description Add a user to the list.
     * @param {CSocket} user - The user to add.
     * @throws {Error} if the user is not a CSocket object.
     * @description if the user is already in the list, nothing will happen.
     */
    add_to_list(user){
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        this._user_list.add(user);
    }

    /**
     * @description Tell if a user can join the room.
     * @param {CSocket} user - The user to check.
     * @throws {Error} if the user is not a CSocket object.
     * @returns {boolean} true if the user can join the room, false otherwise.
     */
    can_join(user){
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        if(this._use_as_whitelist){
            return this._user_list.has(user);
        }
        else{
            return !this._user_list.has(user);
        }
    }

    /**
     * @description Tell if a user can see the room.
     * @param {CSocket} user - The user to check.
     * @throws {Error} if the user is not a CSocket object.
     * @returns {boolean} true if the user can see the room, false otherwise.
     * @description if the room is visible, everyone can see it, otherwise only users that can join it can see it.
     * @see Room#can_join
     */
    can_see(user){
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        return this._is_visible || this.can_join(user); //if the room is visible, everyone can see it, otherwise only users that can join it can see it
    }

    /**
     * @description Tell if a user is in the room.
     * @param {CSocket} user - The user to check.
     * @throws {Error} if the user is not a CSocket object.
     * @returns {boolean} true if the user is in the room, false otherwise.
     */
    isIn(user){
        if(!user instanceof CSocket) throw new Error("user is not a CSocket Object");
        return this._users.has(user);
    }

    /**
     * @description Emit an event to all the users in the room.
     * @param {EVENT} event - The event to emit.
     * @param {...any} args - The arguments to send with the event.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event cannot be initiated by the server.
     * @throws {Error} if the number of arguments is invalid.
     * @throws {Error} if the type of an argument is invalid.
     * @see CSocket#emit
     * @see Room#transmit
     */
    emit(event, ...args){
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event.server_to_client){ throw new Error("event " + event + " cannot be initiated by the server (if he's just transmitting it, use 'transmit' instead)"); }

        if(args.length != event.payload.length) throw new Error("invalid number of arguments, expected " + event.payload.length + " got " + args.length);
        for(let i = 0; i &lt; args.length; i++){
            if(typeof args[i] !== event.payload[i].type) throw new Error("invalid type for argument " + i + ", expected " + event.payload[i].type + " got " + typeof args[i]);
        }

        for(let user of this._users){
            user.emit(event, ...args);
        }
    }

    /**
     * @description Transmit an sent by one of the users in the room to all the users in the room.
     * @param {EVENT} event - The event to transmit.
     * @param {...any} args - The arguments to send with the event.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the number of arguments is invalid.
     * @throws {Error} if the type of an argument is invalid.
     * @see CSocket#transmit
     * @see Room#emit
     * @description this method is used to transmit an event that was sent by a user in the room to all the other users in the room; if the event is intitiated by the server, use {@link Room#emit} instead.
     */
    transmit(event, ...args){
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        //we are not checking if the event can be transmitted by the server because it's not the server that is transmitting it

        if(args.length != event.payload.length) throw new Error("invalid number of arguments, expected " + event.payload.length + " got " + args.length);
        for(let i = 0; i &lt; args.length; i++){
            if(typeof args[i] !== event.payload[i].type) throw new Error("invalid type for argument " + i + ", expected " + event.payload[i].type + " got " + typeof args[i]);
        }

        for(let user of this._users){
            user.transmit(event, ...args);
        }
    }

    /**
     * @description Register a new event listener for all the users in the room.
     * @param {EVENT} event - The event to listen to.
     * @param {function} callback - The callback function.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event cannot be initiated by the client.
     */
    on(event, callback){
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event.client_to_server){ throw new Error("event " + event + " cannot be initiated by the client"); }

        if(typeof callback !== "function") throw new Error("callback is not a function");

        for(let user of this._users){
            user.on(event, callback);
        }
    }
}

/**
 * @description This class represent a socket.
 * @memberof ServerSocket
 */
class CSocket{  //this is server side socket
    /**
     * @description Create a new CSocket object.
     * @param {Socket} socket - The socket.io socket object.
     * @throws {Error} if the socket is undefined.
     */
    constructor(socket){
        if(!socket) throw new Error("socket is undefined");
        this._socket = socket;
    }

    /**
     * @description Emit an event to the client. This event is initiated by the server. If the event is sent by a user, use {@link ServerSocket.CSocket#transmit transmit} instead.
     * @param {EVENT} event - The event to emit.
     * @param {...any} args - The arguments to send with the event.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event cannot be initiated by the server.
     * @throws {Error} if the number of arguments is invalid.
     * @throws {Error} if the type of an argument is invalid.
     * @see {@link ClientSocket.CSocket#on}
     * @see {@link ClientSocket.CSocket#once}
     * @see {@link ServerSocket.CSocket#transmit transmit}
     */
    emit(event, ...args){
        if(event == undefined) throw new Error("event is undefined");
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event.server_to_client){ throw new Error("event " + event + " cannot be initiated by the server (if he's just transmitting it, use 'transmit' instead)"); }

        if(args.length != event.payload.length) throw new Error("invalid number of arguments, expected " + event.payload.length + " got " + args.length);
        for(let i = 0; i &lt; args.length; i++){
            if(typeof args[i] !== event.payload[i].type) throw new Error("invalid type for argument " + i + ", expected " + event.payload[i].type + " got " + typeof args[i]);
        }

        this._socket.emit(String(event), ...args);
    }

    /**
     * @description Transmit an event  sent by a user to the client. This method is used to transmit an event that was sent by a user to the client; if the event is intitiated by the server, use {@link ServerSocket.CSocket#emit emit} instead.
     * @param {EVENT} event - The event to transmit.
     * @param {...any} args - The arguments to send with the event.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the number of arguments is invalid.
     * @throws {Error} if the type of an argument is invalid.
     * @see {@link ClientSocket.CSocket#on}
     * @see {@link ClientSocket.CSocket#once}
     * @see {@link ServerSocket.CSocket#emit emit}
     */
    transmit(event, ...args){
        if(event == undefined) throw new Error("event is undefined");
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        //we are not checking if the event can be transmitted by the server because it's not the server that is transmitting it

        if(args.length != event.payload.length) throw new Error("invalid number of arguments, expected " + event.payload.length + " got " + args.length);
        for(let i = 0; i &lt; args.length; i++){
            if(typeof args[i] !== event.payload[i].type) throw new Error("invalid type for argument " + i + ", expected " + event.payload[i].type + " got " + typeof args[i]);
        }

        this._socket.emit(String(event), ...args);
    }

    /**
     * @description Register a new event listener. the callback will be called every time the event is received. For a one time event listener, use {@link ServerSocket.CSocket#once once} instead.
     * @param {EVENT} event - The event to listen to.
     * @param {function} callback - The callback function.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event cannot be initiated by the client.
     * @throws {Error} if the callback is not a function.
     * @see {@link ClientSocket.CSocket#emit}
     * @see {@link ServerSocket.CSocket#once}
     * 
     */
    on(event, callback){
        if(event == undefined) throw new Error("event is undefined");
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event.client_to_server){ console.warn("warning : event " + event + " cannot be initiated by the client"); }

        if(typeof callback !== "function") throw new Error("callback is not a function");
        
        this._socket.on(String(event), callback);
    }

    /**
     * @description Register a new event listener that will be caught only once.
     * @param {EVENT} event - The event to listen to.
     * @param {function} callback - The callback function.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event cannot be initiated by the client.
     * @throws {Error} if the callback is not a function.
     * @see {@link ServerSocket.CSocket#on}
     * @see {@link ClientSocket.CSocket#emit}
     */
    once(event, callback){
        if(event == undefined) throw new Error("event is undefined");
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event.client_to_server){ console.warn("warning : event " + event + " cannot be initiated by the client"); }

        if(typeof callback !== "function") throw new Error("callback is not a function");
        this._socket.once(String(event), callback);
    }

    /**
     * @description Disconnect the socket, closing the connection.
     * @see CSocket#connect
     */
    disconnect(){
        this._socket.disconnect();
    }

    /**
     * @description add the socket to a room.
     * @param {Room} room - The room to join.
     * @throws {Error} if the room is not a Room object.
     * @throws {Error} if the room is not visible.
     */
    join(room){
        if(!room instanceof Room) throw new Error("room is not a Room Object");
        if(room.addUser(this)){
            this._socket.join(room.name);
        }
        else{
            throw new Error("unable to join room " + room.name);
        }
    }

    /**
     * @description remove the socket from a room.
     * @param {Room} room - The room to leave.
     * @throws {Error} if the room is not a Room object.
     */
    leave(room){
        room.removeUser(this);
    }

    /**
     * @returns {string} The socket id.
     * @description this id is unique for each socket, and will be different for each connection of the same client (this can't be used to identify a client)
     * @readonly
     */
    get id(){
        return this._socket.id;
    }
}

/**
 * @description This class represent a socket.io server.
 * @memberof ServerSocket
 */
class CIO{
    /**
     * @description Create a new CIO object.
     * @param {Server} io - The socket.io server object.
     * @throws {Error} if io is undefined.
     */
    constructor(io){
        if(!io) throw new Error("io is undefined");
        this._io = io;

        this._sockets = new Set();
    }

    /**
     * @description Create a {@link ServerSocket.CIO CIO} object from an express server object.
     * @param {Server} server The express server object.
     * @returns {CIO} The CIO object.
     * @static
     */
    static from_server(server){
        return new CIO(new Server(server));
    }

    /**
     * @description register a new event listener for all sockets connected to the server.
     * @param {EVENT} event The event to listen to.
     * @param {function} callback The callback function.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event is not a connection event.
     * @throws {Error} if the callback is not a function.
     */
    on(event, callback){
        if(event == undefined) throw new Error("event is undefined");
        if(! event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event === EVENTS.INTERNAL.CONNECTION &amp;&amp; !event === EVENTS.INTERNAL.CONNECT) throw new Error("event is not a connection event");
        if(typeof callback !== "function") throw new Error("callback is not a function");
        this._io.on(event, (socket) => {
            let csocket = new CSocket(socket);
            this._sockets.add(csocket);
            callback(csocket);
        });
    }

    /**
     * @description emit an event to all the sockets connected to the server.
     * @param {EVENT} event - The event to emit.
     * @param {...any} args - The arguments to send with the event.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the event cannot be initiated by the server.
     * @throws {Error} if the number of arguments is invalid.
     * @throws {Error} if the type of an argument is invalid.
     * @see CSocket#emit
     * @see CIO#transmit
     */
    emit(event, ...args){
        if(event == undefined) throw new Error("event is undefined");
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        if(!event.server_to_client){ throw new Error("event " + event + " cannot be initiated by the server (if he's just transmitting it, use 'transmit' instead)"); }

        if(args.length != event.payload.length) throw new Error("invalid number of arguments, expected " + event.payload.length + " got " + args.length);
        for(let i = 0; i &lt; args.length; i++){
            if(typeof args[i] !== event.payload[i].type) throw new Error("invalid type for argument " + i + ", expected " + event.payload[i].type + " got " + typeof args[i]);
        }

        this._io.emit(String(event), ...args);
    }

    /**
     * @description Transmit an event sent by a user to all the sockets connected to the server.
     * @param {EVENT} event - The event to transmit.
     * @param {...any} args - The arguments to send with the event.
     * @throws {Error} if the event is undefined.
     * @throws {Error} if the event is not an EVENT object.
     * @throws {Error} if the number of arguments is invalid.
     * @throws {Error} if the type of an argument is invalid.
     * @see CSocket#transmit
     * @see CIO#emit
     */
    transmit(event, ...args){
        if(event == undefined) throw new Error("event is undefined");
        if(!event instanceof EVENT) throw new Error("event is not an EVENT Object");
        //we are not checking if the event can be transmitted by the server because it's not the server that is transmitting it
        
        if(args.length != event.payload.length) throw new Error("invalid number of arguments, expected " + event.payload.length + " got " + args.length);
        for(let i = 0; i &lt; args.length; i++){
            if(typeof args[i] !== event.payload[i].type) throw new Error("invalid type for argument " + i + ", expected " + event.payload[i].type + " got " + typeof args[i]);
        }

        this._io.emit(String(event), ...args);
    }
}

module.exports = { EVENTS, Room, CSocket, CIO };</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ClientSocket.CSocket.html">CSocket</a></div><div class="sidebar-section-children"><a href="Events.EVENT.html">EVENT</a></div><div class="sidebar-section-children"><a href="Events.EVENTS_NAMESPACE.html">EVENTS_NAMESPACE</a></div><div class="sidebar-section-children"><a href="Game.html">Game</a></div><div class="sidebar-section-children"><a href="GameLoader.html">GameLoader</a></div><div class="sidebar-section-children"><a href="Server.User.html">User</a></div><div class="sidebar-section-children"><a href="ServerSocket.CIO.html">CIO</a></div><div class="sidebar-section-children"><a href="ServerSocket.CSocket.html">CSocket</a></div><div class="sidebar-section-children"><a href="ServerSocket.Room.html">Room</a></div><div class="sidebar-section-children"><a href="Settings.html">Settings</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ClientSocket.html">ClientSocket</a></div><div class="sidebar-section-children"><a href="Events.html">Events</a></div><div class="sidebar-section-children"><a href="Server.html">Server</a></div><div class="sidebar-section-children"><a href="Server.JsonChecker.html">JsonChecker</a></div><div class="sidebar-section-children"><a href="Server.ServerSocket.html">ServerSocket</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>